var xe=(a,e,t)=>{if(!e.has(a))throw TypeError("Cannot "+t)};var n=(a,e,t)=>(xe(a,e,"read from private field"),t?t.call(a):e.get(a)),f=(a,e,t)=>{if(e.has(a))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(a):e.set(a,t)},p=(a,e,t,s)=>(xe(a,e,"write to private field"),s?s.call(a,t):e.set(a,t),t);var A=(a,e,t)=>(xe(a,e,"access private method"),t);import{c as q,l as Fe,e as tt,W as D,F as x}from"./model-viewer-2bdea08d.js";import{Q as Ve,x as qe,H as Ue,C as We,L as je,t as Ye,a as ze,D as st,O as it,$ as rt,b as nt,v as at,l as ot}from"./gltf-transform-70a30bbf.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();const _e={HTML:`
        <div class="cube">
          <svg class="cube__face--top" viewBox="0 0 24 24">
            <rect x="2" y="2" width="20" height="20" rx="2" />
          </svg>
          <svg class="cube__face--front" viewBox="0 0 24 24">
            <rect x="2" y="2" width="20" height="20" rx="2" />
          </svg>
          <svg class="cube__face--left" viewBox="0 0 24 24">
            <rect x="2" y="2" width="20" height="20" rx="2" />
          </svg>
          <svg class="cube__face--right" viewBox="0 0 24 24">
            <rect x="2" y="2" width="20" height="20" rx="2" />
          </svg>
          <svg class="cube__face--back" viewBox="0 0 24 24">
            <rect x="2" y="2" width="20" height="20" rx="2" />
          </svg>
        </div>
        <span class="loading-text">Loading 3D...</span>`,CSS:`
      *,
      *::before,
      *::after {
          box-sizing: border-box;
      }
      .cube {
        animation: anim-cube-rotate 2s linear infinite;
        height: 3rem;
        position: relative;
        transform: rotateX(-40deg) rotateY(60deg);
        transform-style: preserve-3d;
        width: 3rem;
      }
  
      [class^="cube__face--"] {
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        fill: none;
        height: 100%;
        left: 0;
        position: absolute;
        stroke: currentColor;
        stroke-linecap: round;
        stroke-linejoin: round;
        stroke-width: 2;
        top: 0;
        transform-origin: top;
        transform-style: preserve-3d;
        width: 100%;
      }
  
      @keyframes anim-cube-rotate {
        from { transform: rotateX(-40deg) rotateY(45deg); }
        to { transform: rotateX(-40deg) rotateY(-315deg); }
      }
  
      .cube__face--top { transform: rotateX(90deg) translate3d(0, -1.5rem, 0); }
      .cube__face--front { transform: translateZ(1.5rem) rotateY(0deg); }
      .cube__face--left { transform: translateX(-1.5rem) rotateY(-90deg); }
      .cube__face--right { transform: translateX(1.5rem) rotateY(90deg); }
      .cube__face--back { transform: translateZ(-1.5rem) rotateY(180deg); }
  
      .loading-text {
        font-family: sans-serif;
        font-size: 1.25rem;
        font-weight: bold;
        margin-top: 2.5rem;
      }
  
      @media screen and (min-width: 32rem) {
        .cube {
          height: 4rem;
          width: 4rem;
        }
        
        .cube__face--top { transform: rotateX(90deg) translate3d(0, -2rem, 0); }
        .cube__face--front { transform: translateZ(2rem) rotateY(0deg); }
        .cube__face--left { transform: translateX(-2rem) rotateY(-90deg); }
        .cube__face--right { transform: translateX(2rem) rotateY(90deg); }
        .cube__face--back { transform: translateZ(-2rem) rotateY(180deg); }
        
        .loading-text {
          margin-top: 3rem;
        }
      }`};var b;class lt{constructor(e){f(this,b,void 0);const t=document.createElement("style");p(this,b,document.createElement("div")),n(this,b).id="dopple-loading-screen",n(this,b).style.position="absolute",n(this,b).style.alignItems="center",n(this,b).style.background="#FFF",n(this,b).style.display="none",n(this,b).style.flexDirection="column",n(this,b).style.justifyContent="center",n(this,b).style.zIndex="2",n(this,b).style.top="0px",n(this,b).style.left="0px",n(this,b).style.width="100%",n(this,b).style.height="100%",t.textContent=_e.CSS,n(this,b).innerHTML=_e.HTML,document.head.append(t),e.appendChild(n(this,b))}show(){n(this,b).style.display="flex"}hide(){n(this,b).style.display="none"}}b=new WeakMap;const ct="",S="srgb",Te="srgb-linear",ht="display-p3",Xe="display-p3-linear",ye="linear",Ne="srgb",Be="rec709",De="p3";class oe{constructor(e,t,s,r,i,o,l,c,d){oe.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,s,r,i,o,l,c,d)}set(e,t,s,r,i,o,l,c,d){const m=this.elements;return m[0]=e,m[1]=r,m[2]=l,m[3]=t,m[4]=i,m[5]=c,m[6]=s,m[7]=o,m[8]=d,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],this}extractBasis(e,t,s){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const s=e.elements,r=t.elements,i=this.elements,o=s[0],l=s[3],c=s[6],d=s[1],m=s[4],F=s[7],M=s[2],v=s[5],y=s[8],E=r[0],_=r[3],N=r[6],B=r[1],g=r[4],u=r[7],L=r[2],fe=r[5],pe=r[8];return i[0]=o*E+l*B+c*L,i[3]=o*_+l*g+c*fe,i[6]=o*N+l*u+c*pe,i[1]=d*E+m*B+F*L,i[4]=d*_+m*g+F*fe,i[7]=d*N+m*u+F*pe,i[2]=M*E+v*B+y*L,i[5]=M*_+v*g+y*fe,i[8]=M*N+v*u+y*pe,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],s=e[1],r=e[2],i=e[3],o=e[4],l=e[5],c=e[6],d=e[7],m=e[8];return t*o*m-t*l*d-s*i*m+s*l*c+r*i*d-r*o*c}invert(){const e=this.elements,t=e[0],s=e[1],r=e[2],i=e[3],o=e[4],l=e[5],c=e[6],d=e[7],m=e[8],F=m*o-l*d,M=l*c-m*i,v=d*i-o*c,y=t*F+s*M+r*v;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const E=1/y;return e[0]=F*E,e[1]=(r*d-m*s)*E,e[2]=(l*s-r*o)*E,e[3]=M*E,e[4]=(m*t-r*c)*E,e[5]=(r*i-l*t)*E,e[6]=v*E,e[7]=(s*c-d*t)*E,e[8]=(o*t-s*i)*E,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,s,r,i,o,l){const c=Math.cos(i),d=Math.sin(i);return this.set(s*c,s*d,-s*(c*o+d*l)+o+e,-r*d,r*c,-r*(-d*o+c*l)+l+t,0,0,1),this}scale(e,t){return this.premultiply(be.makeScale(e,t)),this}rotate(e){return this.premultiply(be.makeRotation(-e)),this}translate(e,t){return this.premultiply(be.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,s,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,s=e.elements;for(let r=0;r<9;r++)if(t[r]!==s[r])return!1;return!0}fromArray(e,t=0){for(let s=0;s<9;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){const s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const be=new oe,Ie=new oe().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Pe=new oe().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),le={[Te]:{transfer:ye,primaries:Be,toReference:a=>a,fromReference:a=>a},[S]:{transfer:Ne,primaries:Be,toReference:a=>a.convertSRGBToLinear(),fromReference:a=>a.convertLinearToSRGB()},[Xe]:{transfer:ye,primaries:De,toReference:a=>a.applyMatrix3(Pe),fromReference:a=>a.applyMatrix3(Ie)},[ht]:{transfer:Ne,primaries:De,toReference:a=>a.convertSRGBToLinear().applyMatrix3(Pe),fromReference:a=>a.applyMatrix3(Ie).convertLinearToSRGB()}},dt=new Set([Te,Xe]),R={enabled:!0,_workingColorSpace:Te,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(a){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!a},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(a){if(!dt.has(a))throw new Error(`Unsupported working color space, "${a}".`);this._workingColorSpace=a},convert:function(a,e,t){if(this.enabled===!1||e===t||!e||!t)return a;const s=le[e].toReference,r=le[t].fromReference;return r(s(a))},fromWorkingColorSpace:function(a,e){return this.convert(a,this._workingColorSpace,e)},toWorkingColorSpace:function(a,e){return this.convert(a,e,this._workingColorSpace)},getPrimaries:function(a){return le[a].primaries},getTransfer:function(a){return a===ct?ye:le[a].transfer}};function Ee(a){return a<.04045?a*.0773993808:Math.pow(a*.9478672986+.0521327014,2.4)}function we(a){return a<.0031308?a*12.92:1.055*Math.pow(a,.41666)-.055}const Ze={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},k={h:0,s:0,l:0},ce={h:0,s:0,l:0};function Me(a,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?a+(e-a)*6*t:t<1/2?e:t<2/3?a+(e-a)*6*(2/3-t):a}class de{constructor(e,t,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,s)}set(e,t,s){if(t===void 0&&s===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,s);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=S){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,R.toWorkingColorSpace(this,t),this}setRGB(e,t,s,r=R.workingColorSpace){return this.r=e,this.g=t,this.b=s,R.toWorkingColorSpace(this,r),this}setHSL(e,t,s,r=R.workingColorSpace){if(e=tt(e,1),t=q(t,0,1),s=q(s,0,1),t===0)this.r=this.g=this.b=s;else{const i=s<=.5?s*(1+t):s+t-s*t,o=2*s-i;this.r=Me(o,i,e+1/3),this.g=Me(o,i,e),this.b=Me(o,i,e-1/3)}return R.toWorkingColorSpace(this,r),this}setStyle(e,t=S){function s(i){i!==void 0&&parseFloat(i)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let i;const o=r[1],l=r[2];switch(o){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return s(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,t);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return s(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,t);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return s(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const i=r[1],o=i.length;if(o===3)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(i,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=S){const s=Ze[e.toLowerCase()];return s!==void 0?this.setHex(s,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ee(e.r),this.g=Ee(e.g),this.b=Ee(e.b),this}copyLinearToSRGB(e){return this.r=we(e.r),this.g=we(e.g),this.b=we(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=S){return R.fromWorkingColorSpace(w.copy(this),e),Math.round(q(w.r*255,0,255))*65536+Math.round(q(w.g*255,0,255))*256+Math.round(q(w.b*255,0,255))}getHexString(e=S){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=R.workingColorSpace){R.fromWorkingColorSpace(w.copy(this),t);const s=w.r,r=w.g,i=w.b,o=Math.max(s,r,i),l=Math.min(s,r,i);let c,d;const m=(l+o)/2;if(l===o)c=0,d=0;else{const F=o-l;switch(d=m<=.5?F/(o+l):F/(2-o-l),o){case s:c=(r-i)/F+(r<i?6:0);break;case r:c=(i-s)/F+2;break;case i:c=(s-r)/F+4;break}c/=6}return e.h=c,e.s=d,e.l=m,e}getRGB(e,t=R.workingColorSpace){return R.fromWorkingColorSpace(w.copy(this),t),e.r=w.r,e.g=w.g,e.b=w.b,e}getStyle(e=S){R.fromWorkingColorSpace(w.copy(this),e);const t=w.r,s=w.g,r=w.b;return e!==S?`color(${e} ${t.toFixed(3)} ${s.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(s*255)},${Math.round(r*255)})`}offsetHSL(e,t,s){return this.getHSL(k),this.setHSL(k.h+e,k.s+t,k.l+s)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,s){return this.r=e.r+(t.r-e.r)*s,this.g=e.g+(t.g-e.g)*s,this.b=e.b+(t.b-e.b)*s,this}lerpHSL(e,t){this.getHSL(k),e.getHSL(ce);const s=Fe(k.h,ce.h,t),r=Fe(k.s,ce.s,t),i=Fe(k.l,ce.l,t);return this.setHSL(s,r,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,s=this.g,r=this.b,i=e.elements;return this.r=i[0]*t+i[3]*s+i[6]*r,this.g=i[1]*t+i[4]*s+i[7]*r,this.b=i[2]*t+i[5]*s+i[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const w=new de;de.NAMES=Ze;var j,Y,me,Ke,ue,Je,ge,Qe;class mt{constructor(e,t){f(this,me);f(this,ue);f(this,ge);f(this,j,void 0);f(this,Y,void 0);p(this,j,e),p(this,Y,t)}get material(){return n(this,j)}get channel(){return n(this,Y)}async load(){const e=this.channel.texture.files.find(s=>s.name==="ar")??this.channel.texture.files.find(s=>s.name==="initial");e.name==="initial"&&console.warn(`No AR texture was found for ${this.channel.name}! Using initial texture instead!`);const t=await this.material.product.scene.modelViewer.createTexture(e.url);this.material.setChannel(this.channel.channel,t),(this.channel.vScale!=null||this.channel.uScale!=null)&&t.sampler.setScale({u:this.channel.uScale??1,v:this.channel.vScale??1}),(this.channel.uOffset!=null||this.channel.vOffset!=null)&&t.sampler.setOffset({u:this.channel.uOffset??0,v:this.channel.vOffset??0}),this.channel.wAng!=null&&t.sampler.setRotation(this.channel.wAng),this.channel.wrapU!=null&&A(this,me,Ke).call(this,this.channel.wrapU,t),this.channel.wrapV!=null&&A(this,ue,Je).call(this,this.channel.wrapV,t),this.channel.samplingMode!=null&&A(this,ge,Qe).call(this,this.channel.samplingMode,t)}}j=new WeakMap,Y=new WeakMap,me=new WeakSet,Ke=function(e,t){e===0?t.sampler.setWrapS(D.ClampToEdge):e===2?t.sampler.setWrapS(D.MirroredRepeat):t.sampler.setWrapS(D.Repeat)},ue=new WeakSet,Je=function(e,t){e===0?t.sampler.setWrapT(D.ClampToEdge):e===2?t.sampler.setWrapT(D.MirroredRepeat):t.sampler.setWrapT(D.Repeat)},ge=new WeakSet,Qe=function(e,t){switch(e){case"LINEAR_LINEAR":{t.sampler.setMagFilter(x.Linear),t.sampler.setMinFilter(x.Linear);break}case"LINEAR_NEAREST":{t.sampler.setMagFilter(x.Linear),t.sampler.setMinFilter(x.Nearest);break}case"NEAREST_LINEAR":{t.sampler.setMagFilter(x.Nearest),t.sampler.setMinFilter(x.Linear);break}case"NEAREST_LINEAR_MIPLINEAR":{t.sampler.setMagFilter(x.Nearest),t.sampler.setMinFilter(x.LinearMipmapLinear);break}case"NEAREST_NEAREST":{t.sampler.setMagFilter(x.Nearest),t.sampler.setMinFilter(x.Nearest);break}case"NEAREST_LINEAR_MIPNEAREST":{t.sampler.setMagFilter(x.Nearest),t.sampler.setMinFilter(x.LinearMipmapNearest);break}case"LINEAR_NEAREST_MIPNEAREST":{t.sampler.setMagFilter(x.Linear),t.sampler.setMinFilter(x.NearestMipmapNearest);break}case"LINEAR_NEAREST_MIPLINEAR":{t.sampler.setMagFilter(x.Linear),t.sampler.setMinFilter(x.NearestMipmapLinear);break}case"NEAREST_NEAREST_MIPLINEAR":{t.sampler.setMagFilter(x.Nearest),t.sampler.setMinFilter(x.NearestMipmapLinear);break}case"LINEAR_LINEAR_MIPLINEAR":{t.sampler.setMagFilter(x.Linear),t.sampler.setMinFilter(x.LinearMipmapLinear);break}case"LINEAR_LINEAR_MIPNEAREST":{t.sampler.setMagFilter(x.Linear),t.sampler.setMinFilter(x.LinearMipmapNearest);break}case"NEAREST_NEAREST_MIPNEAREST":t.sampler.setMagFilter(x.Nearest),t.sampler.setMinFilter(x.NearestMipmapNearest)}};var z,h,X,P,$;class ut{constructor(e,t){f(this,z,void 0);f(this,h,void 0);f(this,X,void 0);f(this,P,void 0);f(this,$,void 0);p(this,z,e),p(this,h,t),p(this,$,this.product.mesh.document.getRoot().listMaterials().find(s=>s.getName()===n(this,h).name)),this.gltfMaterial||p(this,$,this.product.mesh.createMaterial(n(this,h).name))}get name(){return n(this,h).name}get product(){return n(this,z)}get channels(){return n(this,X)}get gltfMaterial(){return n(this,$)}get mvMaterial(){return n(this,P)}async load(){var s,r,i,o,l,c,d,m,F,M,v,y,E,_,N,B;p(this,X,n(this,h).channels.map(g=>new mt(this,g))),n(this,h).data.transparencyMode==="ALPHATEST"?this.gltfMaterial.setAlphaMode("MASK"):(n(this,h).data.transparencyMode==="ALPHABLEND"||n(this,h).data.transparencyMode==="ALPHATESTANDBLEND")&&this.gltfMaterial.setAlphaMode("BLEND");const e=(s=n(this,h).data.albedoColor)==null?void 0:s.map(g=>g/255);e&&this.setAlbedoColor(e);const t=(r=n(this,h).data.emissiveColor)==null?void 0:r.map(g=>g/255);if(t&&this.setEmissiveColor(t),this.gltfMaterial.setMetallicFactor(n(this,h).data.metallic??1),this.gltfMaterial.setRoughnessFactor(n(this,h).data.roughness??1),(o=(i=n(this,h).data.extensions)==null?void 0:i.ior)!=null&&o.isEnabled){const g=this.product.mesh.document.createExtension(Ve),u=g.createIOR();n(this,h).data.extensions.ior.indexOfRefraction!==void 0&&u.setIOR(n(this,h).data.extensions.ior.indexOfRefraction),this.gltfMaterial.setExtension(g.extensionName,u)}if((c=(l=n(this,h).data.extensions)==null?void 0:l.sheen)!=null&&c.isEnabled){const g=this.product.mesh.document.createExtension(qe),u=g.createSheen();n(this,h).data.extensions.sheen.color!==void 0&&u.setSheenColorFactor(n(this,h).data.extensions.sheen.color.map(L=>L/255)),n(this,h).data.extensions.sheen.roughness!==void 0&&u.setSheenRoughnessFactor(n(this,h).data.extensions.sheen.roughness),this.gltfMaterial.setExtension(g.extensionName,u)}if((m=(d=n(this,h).data.extensions)==null?void 0:d.clearcoat)!=null&&m.isEnabled){const g=this.product.mesh.document.createExtension(Ue),u=g.createClearcoat();n(this,h).data.extensions.clearcoat.intensity!==void 0&&u.setClearcoatFactor(n(this,h).data.extensions.clearcoat.intensity),n(this,h).data.extensions.clearcoat.roughness!==void 0&&u.setClearcoatRoughnessFactor(n(this,h).data.extensions.clearcoat.roughness),this.gltfMaterial.setExtension(g.extensionName,u)}if((M=(F=n(this,h).data.extensions)==null?void 0:F.transmission)!=null&&M.isEnabled){const g=this.product.mesh.document.createExtension(We),u=g.createTransmission();n(this,h).data.extensions.transmission.transmissionFactor!==void 0&&u.setTransmissionFactor(n(this,h).data.extensions.transmission.transmissionFactor),this.gltfMaterial.setExtension(g.extensionName,u)}if((y=(v=n(this,h).data.extensions)==null?void 0:v.volume)!=null&&y.isEnabled){const g=this.product.mesh.document.createExtension(je),u=g.createVolume();n(this,h).data.extensions.volume.thicknessFactor!==void 0&&u.setThicknessFactor(n(this,h).data.extensions.volume.thicknessFactor),n(this,h).data.extensions.volume.attenuationDistance!==void 0&&u.setAttenuationDistance(n(this,h).data.extensions.volume.attenuationDistance),n(this,h).data.extensions.volume.attenuationColor!==void 0&&u.setAttenuationColor(n(this,h).data.extensions.volume.attenuationColor.map(L=>L/255)),this.gltfMaterial.setExtension(g.extensionName,u)}if((_=(E=n(this,h).data.extensions)==null?void 0:E.iridescence)!=null&&_.isEnabled){const g=this.product.mesh.document.createExtension(Ye),u=g.createIridescence();n(this,h).data.extensions.iridescence.iridescenceFactor!==void 0&&u.setIridescenceFactor(n(this,h).data.extensions.iridescence.iridescenceFactor),n(this,h).data.extensions.iridescence.iridescenceIor!==void 0&&u.setIridescenceIOR(n(this,h).data.extensions.iridescence.iridescenceIor),n(this,h).data.extensions.iridescence.iridescenceThicknessMinimum!==void 0&&u.setIridescenceThicknessMinimum(n(this,h).data.extensions.iridescence.iridescenceThicknessMinimum),n(this,h).data.extensions.iridescence.iridescenceThicknessMaximum!==void 0&&u.setIridescenceThicknessMaximum(n(this,h).data.extensions.iridescence.iridescenceThicknessMaximum),this.gltfMaterial.setExtension(g.extensionName,u)}if((B=(N=n(this,h).data.extensions)==null?void 0:N.anisotropy)!=null&&B.isEnabled){const g=this.product.mesh.document.createExtension(ze),u=g.createAnisotropy();n(this,h).data.extensions.anisotropy.intensity!==void 0&&u.setAnisotropyStrength(n(this,h).data.extensions.anisotropy.intensity),this.gltfMaterial.setExtension(g.extensionName,u)}}setChannel(e,t){n(this,P)||p(this,P,this.product.scene.modelViewer.model.materials.find(s=>s.name===this.gltfMaterial.getName())),e==="albedo"?this.mvMaterial.pbrMetallicRoughness.baseColorTexture.setTexture(t):e==="bump"?this.mvMaterial.normalTexture.setTexture(t):e==="metallic"?this.mvMaterial.pbrMetallicRoughness.metallicRoughnessTexture.setTexture(t):e==="ambient"?this.mvMaterial.occlusionTexture.setTexture(t):e==="emissive"?this.mvMaterial.emissiveTexture.setTexture(t):e==="sheenColor"?this.mvMaterial.sheenColorTexture.setTexture(t):e==="sheenRoughness"?this.mvMaterial.sheenRoughnessTexture.setTexture(t):e==="clearcoat"?this.mvMaterial.clearcoatTexture.setTexture(t):e==="clearcoatRoughness"?this.mvMaterial.clearcoatRoughnessTexture.setTexture(t):e==="clearcoatBump"?this.mvMaterial.clearcoatNormalTexture.setTexture(t):e==="transmission"?this.mvMaterial.transmissionTexture.setTexture(t):e==="thickness"?this.mvMaterial.thicknessTexture.setTexture(t):e==="iridescence"?this.mvMaterial.iridescenceTexture.setTexture(t):e==="iridescenceThickness"?this.mvMaterial.iridescenceThicknessTexture.setTexture(t):e==="anisotropy"&&this.mvMaterial.anisotropyTexture.setTexture(t)}setAlbedoColor(e){const t=new de(e[0],e[1],e[2]).convertSRGBToLinear();this.gltfMaterial.setBaseColorFactor([t.r,t.g,t.b,n(this,h).data.alpha??1])}setEmissiveColor(e){const t=new de(e[0],e[1],e[2]).convertSRGBToLinear();this.gltfMaterial.setEmissiveFactor([t.r,t.g,t.b])}}z=new WeakMap,h=new WeakMap,X=new WeakMap,P=new WeakMap,$=new WeakMap;let he;async function gt(a){return(await et()).read(a)}async function ft(a){return(await et()).writeBinary(a)}async function et(){return he||(he=new st,he.registerExtensions([it,Ve,qe,Ue,We,je,Ye,ze,rt]).registerDependencies({"draco3d.decoder":await new DracoDecoderModule,"draco3d.encoder":await new DracoEncoderModule})),he}var Z,K,J,Q,ee;class pt{constructor(e,t){f(this,Z,void 0);f(this,K,void 0);f(this,J,void 0);f(this,Q,void 0);f(this,ee,void 0);p(this,Z,e),p(this,K,t)}get product(){return n(this,Z)}get document(){return n(this,J)}get nodes(){return n(this,Q)}get materials(){return n(this,ee)}async load(){p(this,J,await gt(n(this,K))),this.document.getRoot().listNodes().forEach(e=>{const t=e.getMesh();if(t){const s=t.listPrimitives();s.length>1&&(s.forEach((r,i)=>{const o=`${t.getName()}_primitive${i}`,l=this.document.createNode(o);e.addChild(l);const c=t.clone();c.listPrimitives().forEach((m,F)=>{i!==F&&c.removePrimitive(m)}),l.setMesh(c)}),e.setMesh(void 0))}}),p(this,Q,this.document.getRoot().listNodes()),p(this,ee,this.document.getRoot().listMaterials())}createMaterial(e){const t=this.document.createMaterial(e);return this.materials.push(t),t}setVisibility(e,t){const s=this.nodes.find(r=>r.getName()===e);s.getMesh()&&!t&&s.getMesh().detach()}setMaterial(e,t){const s=this.nodes.find(i=>i.getName()===e),r=this.materials.find(i=>i.getName()===t);s.getMesh()&&s.getMesh().listPrimitives().map(i=>i.setMaterial(r))}}Z=new WeakMap,K=new WeakMap,J=new WeakMap,Q=new WeakMap,ee=new WeakMap;let U;async function xt({token:a,sessionId:e},t){const s={};e?s["dopple-sessionid"]=e:s.Authorization=`Bearer ${a}`;const r=new URL("materials",`${U}/`);r.searchParams.set("fields","channels"),r.searchParams.set("ids",t.join(","));const i=[];for(;i.length<t.length;){const o=await fetch(r,{headers:s}).then(l=>l.json());if(o.objects.length===0)break;i.push(...o.objects),r.searchParams.set("offset",i.length.toString())}return i}function $e(a,e){a==="prod"?U="https://api.dopple.io":U=`https://api-${a}.dopple.io`,e?U+=`/services/resource/v1/workspaces/${e}`:U+="/ras/v1"}var te,se,G,O,T,C,H,ie,Ae,re,Ce;const Le=class Le{constructor(e,t,s,r){f(this,ie);f(this,re);f(this,te,void 0);f(this,se,void 0);f(this,G,void 0);f(this,O,void 0);f(this,T,void 0);f(this,C,void 0);f(this,H,void 0);p(this,te,e),p(this,se,t),p(this,T,s),p(this,H,r)}get scene(){return n(this,te)}get ci(){return n(this,se)}get config(){return n(this,T)}get materials(){return n(this,G)}get mesh(){return n(this,O)}get dependencies(){return n(this,C)}async loadGLTF(){const e=this.ci.assets.find(r=>r.name.endsWith(".glb")).url;p(this,O,new pt(this,e)),await n(this,O).load();const t=new Set(this.ci.materials??[]);t.size===0&&(await(await fetch(this.ci.assets.find(i=>i.name==="asset.json").url)).json()).materials.forEach(i=>t.add(i)),this.ci.choices.forEach(r=>{var i;(i=r.options)==null||i.forEach(o=>{var l;n(this,H)[r.id]===o.id&&((l=o.materials)==null||l.forEach(c=>{t.add(c)}))})});const s=await xt(this.scene.authParam,[...t]);p(this,G,s.map(r=>new ut(this,r))),await Promise.all(this.materials.map(r=>r.load())),this.mesh.nodes.forEach(r=>{const i=n(this,T).scene.meshes[r.getName()];i&&(this.mesh.setVisibility(r.getName(),i.visible),this.mesh.setMaterial(r.getName(),i.material))}),this.materials.forEach(r=>{var o,l;const i=n(this,T).scene.materials[r.name];if(i){const c=(o=i.albedoColor)==null?void 0:o.map(m=>m/255);c&&r.setAlbedoColor(c);const d=(l=i.emissiveColor)==null?void 0:l.map(m=>m/255);d&&r.setEmissiveColor(d)}}),p(this,C,n(this,T).dependencies.map(r=>new Le(this.scene,this.ci.dependencies.find(i=>r.namespace===i.namespace&&r.name===i.name&&r.version===i.version),r,n(this,H))).filter(r=>r.config.scene.enabled)),await Promise.all(n(this,C).map(r=>r.loadGLTF()))}async mergeGLTF(){const e=A(this,ie,Ae).call(this);return await e.transform(nt(),at()),e.getRoot().listMaterials().filter((s,r)=>e.getRoot().listMaterials().findIndex(i=>i.getName()===s.getName())!==r).forEach(s=>{const r=e.getRoot().listMaterials().filter(o=>o.getName()===s.getName()),i=r[0];r.forEach(o=>{o!==i&&(o.listParents().filter(l=>l instanceof ot).forEach(l=>l.setMaterial(i)),o.dispose())})}),A(this,re,Ce).call(this,e.getRoot().listMaterials().map(s=>s.getName())),e}async loadTextures(){await Promise.all(this.materials.map(e=>e.channels.map(t=>t.load())).flat()),await Promise.all(n(this,C).map(e=>e.loadTextures()))}};te=new WeakMap,se=new WeakMap,G=new WeakMap,O=new WeakMap,T=new WeakMap,C=new WeakMap,H=new WeakMap,ie=new WeakSet,Ae=function(){const e=n(this,C).reduce((i,o)=>{var l;return A(l=o,ie,Ae).call(l),i.merge(o.mesh.document)},this.mesh.document),t=e.getRoot().listScenes(),s=t[0],r=[];return s.traverse(i=>r.push(i)),r.forEach(i=>{n(this,C).map((l,c)=>l.config.scene.parentNode===i.getName()?c:void 0).filter(l=>l!==void 0).forEach(l=>{t[l+1].listChildren().forEach(d=>i.addChild(d))})}),e.getRoot().listScenes().forEach(i=>i===s?!0:i.dispose()),e},re=new WeakSet,Ce=function(e){p(this,G,this.materials.filter(t=>e.find(s=>s===t.name))),n(this,C).forEach(t=>{var s;return A(s=t,re,Ce).call(s,e)})};let Re=Le,W;async function Ft({token:a,sessionId:e},t,s,r){const i={};let o="ci";return e?(o="products",i["dopple-sessionid"]=e):i.Authorization=`Bearer ${a}`,await(await fetch(`${W}/${o}/${t}:${encodeURIComponent(s)}/versions/${r}?fields=dependencies`,{method:"GET",headers:i})).json()}function Ge(a,e){a==="prod"?W="https://api.dopple.io":W=`https://api-${a}.dopple.io`,e?W+=`/services/product/v2/workspaces/${e}`:W+="/cis/v2"}var ne,V,Se,bt,ae,ke;class ve{constructor(){f(this,Se);f(this,ae);f(this,ne,void 0);f(this,V,void 0)}get authParam(){return n(this,ne)}get modelViewer(){return n(this,V)}get arMode(){return this.modelViewer[Object.getOwnPropertySymbols(this.modelViewer).find(e=>e.description==="arMode")]}async loadConfig(e,t){p(this,ne,e);const s=t.products[0],r=s.values.find(M=>M.property==="$config").value,i={};for(const{property:M,value:v}of s.values)typeof v!="object"&&(i[M]=v);const o=await Ft(this.authParam,r.namespace,r.name,r.version),l=new Re(this,o,r,i);await l.loadGLTF();const c=await l.mergeGLTF(),d=await ft(c),m=new Blob([d]),F=URL.createObjectURL(m);p(this,V,A(this,ae,ke).call(this)),this.modelViewer.setAttribute("src",F),document.body.appendChild(this.modelViewer),await new Promise((M,v)=>{this.modelViewer.addEventListener("load",M),this.modelViewer.addEventListener("error",y=>{console.error(y),v(y)})}),URL.revokeObjectURL(F),await l.loadTextures(),this.arMode==="quick-look"&&await this.modelViewer.activateAR()}async loadGLB(e,t){p(this,V,A(this,ae,ke).call(this)),this.modelViewer.setAttribute("src",e),this.modelViewer.setAttribute("src-ios",t),document.body.appendChild(this.modelViewer),await new Promise(s=>this.modelViewer.addEventListener("load",s)),this.arMode==="quick-look"&&await this.modelViewer.activateAR()}}ne=new WeakMap,V=new WeakMap,Se=new WeakSet,bt=async function(){const e=await this.modelViewer.exportScene(),t=new File([e],"export.glb"),s=document.createElement("a");s.download=t.name,s.href=URL.createObjectURL(t),s.click()},ae=new WeakSet,ke=function(){const e=document.createElement("model-viewer");return e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.setAttribute("ar",""),e.setAttribute("ar-modes","webxr quick-look"),e.setAttribute("ar-scale","auto"),e.setAttribute("camera-controls",""),new URLSearchParams(window.location.search).has("integration")?e.setAttribute("interaction-prompt",'"none"'):e.setAttribute("auto-rotate",""),e};let I;async function Et(a){return await(await fetch(`${I}/token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({id:a})})).json()}async function Oe({token:a,sessionId:e},t){const s={};return e?s["dopple-sessionid"]=e:s.Authorization=`Bearer ${a}`,await(await fetch(`${I}/config?id=${t}`,{method:"GET",headers:s})).json()}function He(a,e){a==="prod"?I="https://api.dopple.io":I=`https://api-${a}.dopple.io`,e?I+=`/services/auth/v4/workspaces/${e}`:I+="/auth/v3"}(async function(){const e=new lt(document.body);e.show();const t=new URLSearchParams(window.location.search),s=t.get("sessionToken"),r=t.get("authSessionId");if(r){const i=t.get("client");if(!i)throw new Error("No client found!");const o=t.get("env")||"prod";He(o,i),$e(o,i),Ge(o,i);const l=t.get("configId"),c=await Oe({sessionId:r},l),d=new ve;await d.loadConfig({sessionId:r},c),d.arMode==="quick-look"&&await new Promise(m=>setTimeout(m,5e3))}else if(s){const i=t.get("client");if(!i)throw new Error("No client found!");const o=t.get("env")||"prod";He(o),$e(o),Ge(o);const l=t.get("sessionId"),c=await Et(i),d=await Oe({token:c.token},l),m=new ve;await m.loadConfig({token:c.token},d),m.arMode==="quick-look"&&await new Promise(F=>setTimeout(F,5e3))}else{const i=t.get("glb"),o=t.get("usdz");if(!i)throw new Error("No glb model found! Please add a 'glb' query parameter.");o||console.warn("No usdz model found! Going to attempt on-the-fly USDZ generation.");const l=new ve;await l.loadGLB(i,o),l.arMode==="quick-look"&&await new Promise(c=>setTimeout(c,5e3))}e.hide()})().catch(a=>{console.error(a)});
